/* ============================================
   CONFIGURATION - Textes des histoires
   ============================================ */

const stories = {
    pocahontas: {
        title: "Pocahontas",
        content: `
            <p>Il √©tait une fois une jeune femme au c≈ìur libre, fille du chef Powhatan, qui √©coutait le vent et parlait aux arbres. Un jour, son monde croisa celui d'un homme venu d'ailleurs, John Smith, explorateur aux r√™ves d'horizons lointains.</p>
            
            <p>Tout les opposait : leurs peuples, leurs langues, leurs croyances. Et pourtant, entre eux, quelque chose naquit. Un regard, une curiosit√©, puis un amour fragile mais sinc√®re.</p>
            
            <p>Quand la haine et la peur menac√®rent de tout d√©truire, Pocahontas fit un choix plus fort que la col√®re. Par amour, elle sauva John, rappelant √† tous que comprendre l'autre est parfois plus courageux que combattre.</p>
            
            <p>Mais les contes ne finissent pas toujours par un d√©part √† deux. Bless√©, John dut retourner en Angleterre pour survivre. Pocahontas, elle, resta aupr√®s de son peuple, fid√®le √† qui elle √©tait.</p>
            
            <p>Ils se quitt√®rent sans promesse impossible, mais avec la certitude que certains amours, m√™me s√©par√©s par l'oc√©an, vivent pour toujours dans le c≈ìur.</p>
        `
    },
    tiana: {
        title: "Tiana",
        content: `
            <p>Il √©tait une fois, √† La Nouvelle-Orl√©ans, une jeune femme qui croyait plus aux r√™ves qu'aux contes de f√©es. Tiana travaillait sans rel√¢che, les mains dans la farine et le c≈ìur rempli d'espoir, convaincue qu'avec assez de courage et de d√©termination, tout √©tait possible.</p>
            
            <p>Un soir, son chemin croisa celui d'un prince un peu perdu, Naveen, transform√© en grenouille par un sortil√®ge. Leur rencontre fut improbable, presque absurde‚Ä¶ et pourtant.</p>
            
            <p>Entre marais enchant√©s et √©preuves inattendues, ils apprirent √† se conna√Ætre, √† s'aider, √† s'aimer vraiment. Pas un amour parfait, mais un amour sinc√®re, construit sur le respect et le soutien.</p>
            
            <p>Le jour o√π ils se dirent "oui", le sort fut bris√©. Non pas par la magie, mais par la force de leurs sentiments. Ensemble, ils r√©alis√®rent le r√™ve de Tiana en ouvrant Tiana's Palace, un lieu vivant de musique, de rires et de parfums gourmands.</p>
            
            <p>Et tandis que la ville dansait sous les √©toiles, Tiana comprit que le plus beau des r√™ves n'√©tait pas seulement un restaurant‚Ä¶ mais de l'avoir construit √† deux.</p>
        `
    },
    vaiana: {
        title: "Vaiana",
        content: `
            <p>Il √©tait une fois une jeune fille n√©e entre la terre et l'oc√©an, appel√©e Vaiana. Contrairement aux contes traditionnels, son histoire n'√©tait pas guid√©e par l'amour d'un prince, mais par l'appel profond de la mer et le devoir envers son peuple.</p>
            
            <p>Depuis toujours, l'oc√©an veillait sur elle, comme un ami fid√®le. Et lorsque son √Æle fut menac√©e, Vaiana n'h√©sita pas √† partir seule, port√©e par son courage et sa d√©termination.</p>
            
            <p>Sur sa route, elle rencontra Maui, demi-dieu aussi impr√©visible que dr√¥le. Ensemble, ils v√©curent une aventure faite de d√©fis, de doutes et de confiance, b√¢tissant une amiti√© sinc√®re plut√¥t qu'une romance attendue.</p>
            
            <p>Vaiana apprit que l'amour pouvait prendre bien des formes : l'amour de sa famille, de son peuple, de ses racines‚Ä¶ et de l'horizon infini qui l'appelait sans cesse √† avancer.</p>
            
            <p>Son c≈ìur resta libre, ouvert, pr√™t √† accueillir un jour peut-√™tre un amour nouveau, lorsque l'oc√©an d√©cidera qu'il est temps, et que le vent soufflera dans la bonne direction.</p>
        `
    },
    final: {
        title: "Le Prince des Comores & la Princesse de Madagascar",
        content: `
            <div class="final-content">
                <img src="assets/images/chimene-disney.jpg" alt="Chim√®ne">
                
                <div class="story-text">
                    <p>Il √©tait une fois, au c≈ìur de l'oc√©an Indien, un jeune prince issu de l'archipel des Comores. H√©ritier des √Æles berc√©es par le vent et les fleurs d'Ylang, il r√™vait d'horizons plus vastes, de routes maritimes √† tracer, et d'un avenir √† construire avec sagesse.</p>
                    
                    <p>Un jour, il entreprit un voyage vers une √Æle voisine, Maurice, afin d'y acqu√©rir un nouveau bateau aupr√®s d'un armateur r√©put√©. Ce navire devait marquer une √©tape importante de sa vie, un pas de plus vers ce qu'il voulait devenir.</p>
                    
                    <p>Sur le chemin, il fit escale chez un cousin, sur une √Æle baign√©e de soleil. Ce n'√©tait qu'un arr√™t, un moment de repos. Rien de plus.</p>
                    
                    <p>Et pourtant‚Ä¶C'est l√† qu'il la vit.Chim√®ne, princesse de Madagascar.</p>
                    
                    <p>Accueillie ce jour-l√† comme une invit√©e pr√©cieuse, elle n'avait ni couronne visible, ni tr√¥ne dor√© mais quelque chose, dans sa pr√©sence, imposait le respect et l'admiration. Un regard doux, une √©l√©gance discr√®te, une lumi√®re tranquille. √Ä cet instant pr√©cis, le prince comprit que certains destins ne pr√©viennent pas.Ils apparaissent.</p>
                    
                    <p>Les flots les s√©par√®rent ensuite, comme souvent lorsque l'oc√©an d√©cide d'√©prouver les c≈ìurs. Le temps passa. Les √Æles rest√®rent grav√©es dans la m√©moire.</p>
                    
                    <p>Puis vint un jour de f√™te o√π le prince √©tait reparti sur l'√Æle Maurice. Un anniversaire pr√©par√© en secret, partag√© avec son cousin car presque par miracle, ils √©taient n√©s √† quelques jours d'√©cart. Ce jour-l√†, la princesse donna tout.Malgr√© la fatigue, malgr√© la maladie, elle offrit sa force, son √©nergie, sa g√©n√©rosit√©. Elle pr√©para la table, les mets, les musiciens.. Tout les d√©tails invisibles qui transforment un instant ordinaire en souvenir ind√©l√©biles.</p>
                    
                    <p>Et c'est l√† que le prince sut. Non pas par des mots. Mais par les actes.</p>
                    
                    <p>Aujourd'hui, le prince se trouve loin des √Æles ayant choisi de partir explorer d'autres terres, apprendre, se confronter au monde et en comprendre les r√®gles.</p>
                    
                    <p>Il traverse des royaumes lointains, d√©couvre de nouveaux horizons, r√©colte ce qui pourra un jour, servir √† b√¢tir quelque chose de plus grand et revenir plus fort, plus sage, et digne de ce qu'il souhaite prot√©ger.</p>
                    
                    <p>Car s'il pla√Æt √† Dieu, un jour, il reviendra vers l'oc√©an Indien. Il reviendra vers ses terres. Et il reviendra vers elle.</p>
                    
                    <p>Mais chaque conte commence par un premier chapitre.</p>
                    
                    <p>Et si cette histoire est destin√©e √† s'√©crire, alors peut-√™tre que tout commence ici‚Ä¶</p>
                </div>
                
                <button class="valentine-button" onclick="showValentineMessage()">
                    üíï Veux-tu √™tre ma Valentine ? üíï
                </button>
            </div>
        `
    }
};

/* ============================================
   VARIABLES GLOBALES
   ============================================ */

// Suivi des cartes ouvertes
const openedCards = {
    pocahontas: false,
    tiana: false,
    vaiana: false
};

// Index de la carte actuelle
let currentCardIndex = 0;

// √âl√©ments DOM
const storyPanel = document.getElementById('story-panel');
const storyContent = document.getElementById('story-content');
const closeStoryBtn = document.getElementById('close-story-btn');
const cardsSection = document.querySelector('.cards-section');
const finalCard = document.getElementById('final-card');
const musicElement = document.getElementById('music');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const currentCardSpan = document.querySelector('.current-card');
const cards = document.querySelectorAll('.card');

/* ============================================
   FONCTIONS PRINCIPALES
   ============================================ */

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', () => {
    // Initialiser l'affichage Cover Flow
    updateCoverFlow();

    // Ajouter les √©couteurs d'√©v√©nements sur les cartes
    cards.forEach(card => {
        card.addEventListener('click', () => handleCardClick(card));
    });

    // Boutons de navigation
    prevBtn.addEventListener('click', goToPreviousCard);
    nextBtn.addEventListener('click', goToNextCard);

    // Fermeture du panneau
    closeStoryBtn.addEventListener('click', closeStoryPanel);

    // Support du clavier
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') goToPreviousCard();
        if (e.key === 'ArrowRight') goToNextCard();
        if (e.key === 'Escape') closeStoryPanel();
    });
});

// Mettre √† jour l'affichage Cover Flow
function updateCoverFlow() {
    const totalCards = cards.length;

    cards.forEach((card, index) => {
        // Retirer toutes les classes de position
        card.classList.remove('center', 'left-1', 'left-2', 'left-3', 'right-1', 'right-2', 'right-3', 'hidden');

        // Calculer la position relative par rapport √† la carte active
        const relativePosition = index - currentCardIndex;

        // Appliquer la classe appropri√©e
        if (relativePosition === 0) {
            card.classList.add('center');
        } else if (relativePosition === -1) {
            card.classList.add('left-1');
        } else if (relativePosition === -2) {
            card.classList.add('left-2');
        } else if (relativePosition <= -3) {
            card.classList.add('left-3');
        } else if (relativePosition === 1) {
            card.classList.add('right-1');
        } else if (relativePosition === 2) {
            card.classList.add('right-2');
        } else if (relativePosition >= 3) {
            card.classList.add('right-3');
        }
    });

    // Mettre √† jour l'indicateur
    currentCardSpan.textContent = currentCardIndex + 1;
}

// Aller √† la carte pr√©c√©dente (navigation circulaire)
function goToPreviousCard() {
    currentCardIndex--;
    if (currentCardIndex < 0) {
        currentCardIndex = cards.length - 1; // Retour √† la derni√®re carte
    }
    updateCoverFlow();
}

// Aller √† la carte suivante (navigation circulaire)
function goToNextCard() {
    currentCardIndex++;
    if (currentCardIndex >= cards.length) {
        currentCardIndex = 0; // Retour √† la premi√®re carte
    }
    updateCoverFlow();
}

// Gestion du clic sur une carte
function handleCardClick(card) {
    // Ne r√©agir que si c'est la carte au centre
    if (!card.classList.contains('center')) return;

    const princess = card.dataset.princess;

    // Si c'est la carte finale et qu'elle est encore verrouill√©e
    if (card.id === 'final-card' && card.classList.contains('locked')) {
        showLockedMessage();
        return;
    }

    // Si c'est la carte finale d√©verrouill√©e
    if (card.id === 'final-card' && card.classList.contains('unlocked')) {
        // Retourner la carte
        card.classList.add('flipped');
        // Ouvrir le panneau avec l'histoire
        setTimeout(() => {
            openFinalStory();
        }, 300);
        return;
    }

    // Pour les cartes de princesses : retourner la carte
    if (princess && stories[princess]) {
        // Retourner la carte
        card.classList.add('flipped');

        // Ouvrir l'histoire apr√®s l'animation de flip
        setTimeout(() => {
            openStory(princess);
        }, 300);
    }
}

// Ouvrir l'histoire d'une princesse
function openStory(princess) {
    const story = stories[princess];

    // Afficher le contenu dans le panneau
    storyContent.innerHTML = `
        <h2>${story.title}</h2>
        ${story.content}
    `;

    // Activer le panneau et minimiser les cartes
    storyPanel.classList.add('active');
    cardsSection.classList.add('minimized');

    // Marquer cette carte comme ouverte
    if (!openedCards[princess]) {
        openedCards[princess] = true;
        checkUnlock();
    }
}

// Ouvrir la carte finale
function openFinalStory() {
    const story = stories.final;

    // Afficher le contenu dans le panneau
    storyContent.innerHTML = `
        <h2>${story.title}</h2>
        ${story.content}
    `;

    // Activer le panneau et minimiser les cartes
    storyPanel.classList.add('active');
    cardsSection.classList.add('minimized');

    // Lancer la musique UNIQUEMENT √† l'ouverture de la carte finale
    playMusic();
}

// Fermer le panneau de texte
function closeStoryPanel() {
    storyPanel.classList.remove('active');
    cardsSection.classList.remove('minimized');
}

// V√©rifier si toutes les cartes ont √©t√© ouvertes
function checkUnlock() {
    const allOpened = openedCards.pocahontas &&
        openedCards.tiana &&
        openedCards.vaiana;

    if (allOpened) {
        unlockFinalCard();
    }
}

// D√©verrouiller la carte finale (SANS lancer la musique)
function unlockFinalCard() {
    finalCard.classList.remove('locked');
    finalCard.classList.add('unlocked');
}

// Message quand on clique sur la carte verrouill√©e
function showLockedMessage() {
    // Petite animation de secousse
    finalCard.style.animation = 'shake 0.5s ease-out';

    setTimeout(() => {
        finalCard.style.animation = '';
    }, 500);
}

// Lancer la musique
function playMusic() {
    if (musicElement) {
        musicElement.volume = 0.5; // Volume √† 50%
        musicElement.play().catch(err => {
            console.log('Lecture audio bloqu√©e:', err);
        });
    }
}

// Message quand on clique sur le bouton Valentine
function showValentineMessage() {
    // Cr√©er un effet de c≈ìurs qui tombent (40 au lieu de 20)
    createHearts();

    // Changer le texte du bouton
    const button = event.target;
    button.textContent = 'üíû Je t\'aime ma princesse üíû';
    button.style.background = 'linear-gradient(135deg, #ff69b4 0%, #ff1493 100%)';
}

// Cr√©er des c≈ìurs anim√©s (40 c≈ìurs au lieu de 20)
function createHearts() {
    for (let i = 0; i < 40; i++) {
        setTimeout(() => {
            const heart = document.createElement('div');
            heart.textContent = 'üíñ';
            heart.style.position = 'fixed';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.top = '-50px';
            heart.style.fontSize = (Math.random() * 30 + 20) + 'px';
            heart.style.zIndex = '9999';
            heart.style.pointerEvents = 'none';
            heart.style.animation = 'fall 3s linear forwards';

            document.body.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 3000);
        }, i * 50); // R√©duit le d√©lai pour plus de densit√©
    }
}

// Animation de secousse pour la carte verrouill√©e
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    
    @keyframes fall {
        to {
            top: 100vh;
            transform: translateX(${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg);
            opacity: 0;
        }
    }
`;
document.head.appendChild(style);
